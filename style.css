/* ===== Root sizing ===== */
:root{
  /* JS updates --board dynamically to fit the viewport (no scroll). */
  --board: 600px;
  --cell: calc(var(--board) / 8);
}

/* ===== Page layout (no page scroll) ===== */
html, body{
  height: 100dvh;            /* locks to device visual viewport (iOS-friendly) */
  overflow: hidden;          /* no page scroll */
}

*{ box-sizing: border-box; }

body{
  margin: 0;
  background: #111;
  color: #fff;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  padding: env(safe-area-inset-top) 8px env(safe-area-inset-bottom);
}

/* ===== HUD ===== */
h1{ margin: 6px 0 0; font-size: clamp(18px, 3.8vw, 28px); }
.hud{
  display: flex; gap: 10px; align-items: center; justify-content: center; flex-wrap: wrap;
  font-weight: 600; text-shadow: 0 1px 2px #0008; padding: 4px 0;
}
.pill{ padding: 6px 10px; border-radius: 999px; background: #222; border: 1px solid #333; }
#status{ display: flex; gap: 8px; align-items: center; flex-wrap: wrap }
.badge{ padding: 4px 8px; border-radius: 999px; border: 1px solid #444; background: #1c1c1c; font-size: 12px; opacity:.9 }
.badge.active{ border-color:#2ecc71; box-shadow:0 0 0 2px #2ecc7133 inset }
#muteBtn{ padding: 6px 10px; border-radius: 999px; border: 1px solid #444; background: #1c1c1c; color:#fff; cursor: pointer; }
button,input{ font-size: 16px; }

/* ===== Game frame (8×8 grid; can’t deform) ===== */
#game{
  position: relative;
  width: var(--board);
  height: auto;
  aspect-ratio: 1 / 1;              /* perfect square board */
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  border: 4px solid #fff;
  border-radius: 12px;
  overflow: hidden;
  background: #222;
  box-shadow: 0 12px 40px #0008, inset 0 0 0 1px #0006;
  transition: transform .12s ease;
}
#game.shake{ animation: shake .35s ease; }
@keyframes shake{
  0%,100%{transform:translate3d(0,0,0)} 20%{transform:translate3d(-6px,0,0)}
  40%{transform:translate3d(6px,0,0)} 60%{transform:translate3d(-4px,0,0)} 80%{transform:translate3d(4px,0,0)}
}

/* ===== Squares (grid children) ===== */
.square{ position: relative; width: 100%; aspect-ratio: 1 / 1; }
.light{ background:#f0d9b5; }
.dark { background:#b58863; }

/* ===== Pieces (absolutely positioned overlay) ===== */
.piece{
  position: absolute;
  width: var(--cell);
  height: var(--cell);
  display: flex; align-items: center; justify-content: center;
  pointer-events: none; user-select: none;
  z-index: 90;
  /* glyph sizing via CSS var; override per-piece class if needed */
  --glyphScale: 0.70;
}

/* Render Unicode via data-glyph for crispness & easy recolor */
.piece::before{
  content: attr(data-glyph);
  font-size: calc(var(--cell) * var(--glyphScale));
  line-height: 1;
}

/* White knight (fully filled) */
.knight{
  z-index: 110;
  color: #fff;                       /* white glyph */
  text-shadow: 0 2px 6px #0009;      /* subtle pop */
  transition: left .18s cubic-bezier(.2,.7,.2,1), top .18s cubic-bezier(.2,.7,.2,1), filter .2s ease;
}
.knight.danger{ filter: drop-shadow(0 0 10px #e74c3c); }

/* Enemies are black */
.enemy{ color: #000; --glyphScale: 0.66; filter: drop-shadow(0 2px 2px rgba(0,0,0,.6)); }

/* ===== Power-ups ===== */
.power{
  position: absolute; z-index: 80; width: var(--cell); height: var(--cell);
  display:flex; align-items:center; justify-content:center; pointer-events:none;
}
.power .glyph{ font-size: calc(var(--cell) * 0.40); filter: drop-shadow(0 2px 4px #0008); }
.power .ring{ position: absolute; width: calc(var(--cell)*0.36); height: calc(var(--cell)*0.36); border-radius: 50%;
  box-shadow: 0 0 0 3px #fff6 inset, 0 0 10px #fff6;
}
.power.fade{ animation: fadeout .45s forwards; }
@keyframes fadeout{ to{ opacity: 0; transform: scale(.9); } }

/* ===== Move dots ===== */
.dot{
  position: absolute; width: var(--cell); height: var(--cell);
  display: flex; align-items: center; justify-content: center; z-index: 120; cursor: pointer;
}
.dot span{
  width: calc(var(--cell) * 0.24); height: calc(var(--cell) * 0.24);
  border-radius: 50%; background: #2ecc71;
  box-shadow: 0 0 0 3px #2ecc7144, 0 2px 6px #0007;
}
.dot:active span{ transform: scale(.92); }

/* ===== SVG Guide arrows ===== */
#guideLayer{ position: absolute; inset: 0; pointer-events: none; z-index: 140; }
.ga-primary{ stroke:#2ecc71; stroke-width:8; fill:none; filter: drop-shadow(0 2px 4px rgba(0,0,0,.6)); }
.ga-hint{ stroke:#00d2ff; stroke-width:6; fill:none; stroke-dasharray:10 8; filter: drop-shadow(0 2px 4px rgba(0,0,0,.5)); }
.ga-invalid{ stroke:#e74c3c; opacity:.6; }
.ga-label{ font:600 14px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; fill:#fff; paint-order:stroke; stroke:#000; stroke-width:3px; }

/* ===== Game over overlay ===== */
#over{
  position: absolute; inset: 0; background: rgba(0,0,0,.55);
  display: none; align-items: center; justify-content: center; flex-direction: column;
  z-index: 200; text-align: center; padding: 20px;
}
#over h2{ margin: 0 0 8px; font-size: clamp(20px, 5vw, 36px); }
#over p{ margin: 0 0 12px; opacity:.9; }
#restart{
  padding: 10px 14px; border-radius: 10px; border: 1px solid #fff4; background: #fff; color: #111; cursor: pointer; font-weight: 700;
}
#saveRow{ display:flex; gap:8px; align-items:center; justify-content:center; margin-top:8px; }
#playerName{ padding: 8px 10px; border-radius: 8px; border: 1px solid #444; background:#222; color: #fff; min-width: 160px; }
#saveBtn{ padding: 8px 12px; border-radius: 8px; border: 1px solid #2ecc71; background: #2ecc71; color: #111; font-weight: 700; cursor: pointer; }
#saveBtn[disabled]{ opacity:.6; cursor: not-allowed; }

/* ===== Leaderboard ===== */
#leaderboard{
  width: min(var(--board), 95vw);
  background:#1a1a1a; border:1px solid #2a2a2a; border-radius:12px;
  box-shadow:0 8px 24px #0007; overflow:hidden; margin:6px 0 10px;
}
#leaderboard header{ display:flex; justify-content:space-between; align-items:center; padding:8px 10px; background:#222; border-bottom:1px solid #2f2f2f; }
#leaderboard h3{ margin:0; font-size:14px; letter-spacing:.3px; }
#lbStatus{ opacity:.8; font-size:12px; }
#leaderboard ol{
  list-style:none; margin:0; padding:8px 10px;
  display:grid; grid-template-columns:1fr auto; row-gap:4px;
  max-height:20dvh; overflow:auto;
}
#leaderboard li{ display: contents; }
#leaderboard .name{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap; padding-right:8px; }
#leaderboard .score{ font-variant-numeric: tabular-nums; }
#toggleLB{ padding:6px 10px; border-radius:8px; border:1px solid #444; background:#333; color:#fff; cursor:pointer; }
#resetScores{ padding:6px 10px; border-radius:8px; border:1px solid #ff7675; background:#ff7675; color:#111; cursor:pointer; font-weight:700; }
#resetScores:active{ transform: translateY(1px); }

/* ===== Sparkle ===== */
.sparkle{
  position:absolute; pointer-events:none; z-index:150;
  width:8px; height:8px; border-radius:50%; background:#fff; opacity:.9; animation:spark .5s ease-out forwards;
}
@keyframes spark{ to{ transform:translateY(-12px) scale(.2); opacity:0; } }
