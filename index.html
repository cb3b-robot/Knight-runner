<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Knight Runner with Multiple Pieces</title>
<style>
body {
  margin:0;
  background:#222;
  font-family:Arial, sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  color:#fff;
}
h1 { margin:10px; text-shadow:2px2px8px #000; }

#game-container {
  position: relative;
  width: 600px;
  height: 600px;
  border: 4px solid #fff;
  border-radius: 10px;
  background-image:
    linear-gradient(45deg, #f0d9b5 25%, transparent 25%),
    linear-gradient(-45deg, #f0d9b5 25%, transparent 25%),
    linear-gradient(45deg, transparent 75%, #b58863 75%),
    linear-gradient(-45deg, transparent 75%, #b58863 75%);
  background-size: 75px 75px;
  background-position: 0 0, 0 37.5px, 37.5px -37.5px, -37.5px 0px;
  overflow: hidden;
}

.knight {
  width:50px;
  height:50px;
  background:red;
  color:white;
  font-weight:bold;
  font-size:30px;
  display:flex;
  justify-content:center;
  align-items:center;
  position:absolute;
  z-index:100;
  transition:top 0.1s,left 0.1s;
}

.obstacle {
  width:50px;
  height:50px;
  color:white;
  font-weight:bold;
  font-size:30px;
  display:flex;
  justify-content:center;
  align-items:center;
  position:absolute;
  z-index:50;
  border-radius:5px;
}

#osd-controls { margin-top:10px; display:flex; flex-wrap:wrap; width:250px; justify-content:center; gap:5px; }

.osd-button {
  width:60px; height:60px; background:#fff; color:#000; font-weight:bold;
  font-size:1.2em; display:flex; justify-content:center; align-items:center;
  border-radius:10px; cursor:pointer; user-select:none; box-shadow:2px2px6px #000;
}

.osd-button:active { transform:scale(0.95); }

#score { margin-top:10px; font-size:1.2em; }

#game-over {
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  font-size:2em; color:#ff4c4c; display:none; text-shadow:2px2px8px #000; z-index:200;
}
</style>
</head>
<body>
<h1>Knight Runner: Chess Pieces</h1>
<div id="game-container"></div>
<div id="score">Score:0</div>
<div id="osd-controls">
  <div class="osd-button" data-dir="up">↑</div>
  <div class="osd-button" data-dir="down">↓</div>
  <div class="osd-button" data-dir="left">←</div>
  <div class="osd-button" data-dir="right">→</div>
</div>

<script>
const container = document.getElementById('game-container');
const scoreDisplay = document.getElementById('score');

// Knight
const knight = document.createElement('div');
knight.classList.add('knight');
knight.textContent = "N";
container.appendChild(knight);

// Game over text
const gameOverText = document.createElement('div');
gameOverText.id='game-over';
gameOverText.textContent='Game Over!';
container.appendChild(gameOverText);

const gridSize = 75;
let knightPos = {x:4, y:4};
let score = 0;
let obstacles = [];

// Helper to place knight
function placeKnight(){
  knight.style.left = `${knightPos.x*gridSize + 12.5}px`;
  knight.style.top = `${knightPos.y*gridSize + 12.5}px`;
}

// Constrain knight inside board
function constrainPosition(pos){
  if(pos.x<0) pos.x=0;
  if(pos.y<0) pos.y=0;
  if(pos.x>7) pos.x=7;
  if(pos.y>7) pos.y=7;
}

// --- Two-step knight move ---
let firstStep = null;
const dirMap = {
  'up': {x:0, y:-1},
  'down': {x:0, y:1},
  'left': {x:-1, y:0},
  'right': {x:1, y:0}
};

function handleStep(dir){
  const move = dirMap[dir];
  if(!move) return;

  if(!firstStep){
    // First click: 2 squares
    firstStep = {dx: move.x*2, dy: move.y*2, dir: move};
  } else {
    // Second click
    // Undo if exact opposite
    if(move.x === -firstStep.dir.x && move.y === -firstStep.dir.y){
      firstStep = null;
      return;
    }
    // Check perpendicular short move
    const dot = firstStep.dir.x*move.x + firstStep.dir.y*move.y;
    if(dot === 0 && (Math.abs(move.x)+Math.abs(move.y)===1)){
      knightPos.x += firstStep.dx + move.x;
      knightPos.y += firstStep.dy + move.y;
      constrainPosition(knightPos);
      placeKnight();
    }
    firstStep = null;
  }
}

// Keyboard controls
document.addEventListener('keydown', e=>{
  switch(e.key){
    case "ArrowUp": handleStep('up'); break;
    case "ArrowDown": handleStep('down'); break;
    case "ArrowLeft": handleStep('left'); break;
    case "ArrowRight": handleStep('right'); break;
  }
});

// OSD buttons
document.querySelectorAll('.osd-button').forEach(btn=>{
  btn.addEventListener('click', ()=> handleStep(btn.dataset.dir));
});

// --- Obstacles ---
const pieceTypes = [
  {type:'P', color:'blue', speed:0.05},
  {type:'B', color:'purple', speed:0.03, diagonal:true},
  {type:'R', color:'green', speed:0.08},
  {type:'Q', color:'gold', speed:0.1}
];

function addObstacle(){
  const piece = pieceTypes[Math.floor(Math.random()*pieceTypes.length)];
  const obs = document.createElement('div');
  obs.classList.add('obstacle');
  obs.textContent = piece.type;
  obs.style.background = piece.color;

  let posX = Math.floor(Math.random()*8);
  obs.style.left = `${posX*gridSize +12.5}px`;
  obs.style.top = `-50px`;

  container.appendChild(obs);
  obstacles.push({el: obs, x: posX, y: -0.5, speed: piece.speed, diagonal: piece.diagonal || false, dirX: Math.random()<0.5?1:-1});
}

function moveObstacles(){
  obstacles.forEach((o, index)=>{
    if(o.diagonal){
      o.x += o.dirX*0.02;
      if(o.x<0) {o.x=0; o.dirX=1;}
      if(o.x>7) {o.x=7; o.dirX=-1;}
      o.el.style.left = `${o.x*gridSize + 12.5}px`;
    }
    o.y += o.speed;
    o.el.style.top = `${o.y*gridSize}px`;

    if(Math.floor(o.y) === knightPos.y && Math.floor(o.x) === knightPos.x){
      gameOver();
    }
    if(o.y > 8){ o.el.remove(); obstacles.splice(index,1); score++; scoreDisplay.textContent=`Score:${score}`; }
  });
}

// Intervals
let moveInterval = setInterval(()=>{ moveObstacles(); }, 20);
let spawnInterval = setInterval(()=>{ addObstacle(); }, 800);

placeKnight();

function gameOver(){ 
  clearInterval(moveInterval); 
  clearInterval(spawnInterval);
  gameOverText.style.display='block'; 
}
</script>
</body>
</html>
